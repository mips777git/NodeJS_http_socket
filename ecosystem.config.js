/**
 * PM2 Process Manager 설정 파일
 * PM2로 NodeSocket 서버를 관리하기 위한 설정
 */

module.exports = {
    apps: [
        {
            // ============================================================
            // 첫 번째 WebSocket 서버 (포트 8080)
            // ============================================================
            name: 'NodeSocket-8080',             // PM2 프로세스 이름
            script: './app.js',                  // 실행할 메인 파일

            // ============================================================
            // 실행 환경 설정
            // ============================================================
            instances: 1,                        // 인스턴스 수
            exec_mode: 'fork',                   // 실행 모드

            // ============================================================
            // 환경 변수
            // ============================================================
            env: {
                NODE_ENV: 'development',
                PORT: 8080
            },
            env_production: {
                NODE_ENV: 'production',
                PORT: 8080
            },

            // ============================================================
            // 로그 설정
            // ============================================================
            log_date_format: 'YYYY-MM-DD HH:mm:ss',
            error_file: './logs/pm2/pm2-8080-err.log',
            out_file: './logs/pm2/pm2-8080-out.log',
            log_file: './logs/pm2/pm2-8080-combined.log',

            // ============================================================
            // 재시작 정책
            // ============================================================
            autorestart: true,
            watch: false,
            max_memory_restart: '500M',
            restart_delay: 4000,

            // ============================================================
            // 고급 설정
            // ============================================================
            min_uptime: '10s',
            max_restarts: 10,
            kill_timeout: 5000,
            listen_timeout: 3000,

            // ============================================================
            // 개발 편의 기능
            // ============================================================
            ignore_watch: [
                'node_modules',
                'logs'
            ],
            watch_options: {
                followSymlinks: false
            }
        },
        {
            // ============================================================
            // 두 번째 WebSocket 서버 (포트 8081)
            // ============================================================
            name: 'NodeSocket-8081',             // PM2 프로세스 이름
            script: './app.js',                  // 실행할 메인 파일

            // ============================================================
            // 실행 환경 설정
            // ============================================================
            instances: 1,                        // 인스턴스 수
            exec_mode: 'fork',                   // 실행 모드

            // ============================================================
            // 환경 변수
            // ============================================================
            env: {
                NODE_ENV: 'development',
                PORT: 8081
            },
            env_production: {
                NODE_ENV: 'production',
                PORT: 8081
            },

            // ============================================================
            // 로그 설정
            // ============================================================
            log_date_format: 'YYYY-MM-DD HH:mm:ss',
            error_file: './logs/pm2/pm2-8081-err.log',
            out_file: './logs/pm2/pm2-8081-out.log',
            log_file: './logs/pm2/pm2-8081-combined.log',

            // ============================================================
            // 재시작 정책
            // ============================================================
            autorestart: true,
            watch: false,
            max_memory_restart: '500M',
            restart_delay: 4000,

            // ============================================================
            // 고급 설정
            // ============================================================
            min_uptime: '10s',
            max_restarts: 10,
            kill_timeout: 5000,
            listen_timeout: 3000,

            // ============================================================
            // 개발 편의 기능
            // ============================================================
            ignore_watch: [
                'node_modules',
                'logs'
            ],
            watch_options: {
                followSymlinks: false
            }
        }
    ]
};
